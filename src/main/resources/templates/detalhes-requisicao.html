<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="'Requisição ' + ${requisicao.codigo} + ' - Sistema de Requisição de Compra'">Detalhes da Requisição</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <h1 class="logo">
                    <i class="fas fa-shopping-cart"></i>
                    Sistema de Requisição de Compra
                </h1>
                <nav class="nav">
                    <a href="/" class="nav-link">Início</a>
                    <a href="/requisicoes" class="nav-link">Requisições</a>
                    <a href="/nova-requisicao" class="nav-link">Nova Requisição</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <div class="page-header">
                <h2 th:text="'Requisição ' + ${requisicao.codigo}">Requisição REQ-001</h2>
                <div class="header-actions">
                    <a th:href="@{/requisicoes}" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i>
                        Voltar
                    </a>
                    <a th:href="@{/requisicoes/{id}/editar(id=${requisicao.id})}" class="btn btn-primary">
                        <i class="fas fa-edit"></i>
                        Editar
                    </a>
                </div>
            </div>

            <div class="requisicao-details">
                <div class="details-grid">
                    <div class="detail-card">
                        <h3>Informações Básicas</h3>
                        <div class="detail-row">
                            <span class="label">Código:</span>
                            <span class="value" th:text="${requisicao.codigo}">REQ-001</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">Nome:</span>
                            <span class="value" th:text="${requisicao.nome}">Material de Escritório</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">Status:</span>
                            <span class="status-badge" th:classappend="${requisicao.status}" th:text="${requisicao.status}">Pendente</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">Departamento:</span>
                            <span class="value" th:text="${requisicao.departamento}">TI</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">Criado por:</span>
                            <span class="value" th:text="${requisicao.criadoPor}">João Silva</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">Data de Criação:</span>
                            <span class="value" th:text="${#temporals.format(requisicao.criadoEm, 'dd/MM/yyyy HH:mm')}">15/01/2024 10:30</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">Prazo de Entrega:</span>
                            <span class="value" th:text="${#temporals.format(requisicao.prazoEntrega, 'dd/MM/yyyy')}">30/01/2024</span>
                        </div>
                    </div>

                    <div class="detail-card">
                        <h3>Finalidade</h3>
                        <p th:text="${requisicao.finalidade}">Aquisição de material de escritório para o departamento de TI.</p>
                    </div>

                    <div class="detail-card" th:if="${requisicao.observacoes}">
                        <h3>Observações</h3>
                        <p th:text="${requisicao.observacoes}">Observações adicionais sobre a requisição.</p>
                    </div>
                </div>

                <div class="items-section">
                    <h3>Itens da Requisição</h3>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Quantidade</th>
                                    <th>Descrição</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="item : ${requisicao.itens}">
                                    <td th:text="${item.nome}">Papel A4</td>
                                    <td th:text="${item.quantidade}">10</td>
                                    <td th:text="${item.descricao}">Resma de papel branco</td>
                                </tr>
                                <tr th:if="${#lists.isEmpty(requisicao.itens)}">
                                    <td colspan="3" class="text-center">Nenhum item cadastrado</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="cotacoes-section" th:if="${requisicao.cotacoes != null and !#lists.isEmpty(requisicao.cotacoes)}">
                    <h3>Cotações</h3>
                    <div class="cotacoes-grid">
                        <div class="cotacao-card" th:each="cotacao : ${requisicao.cotacoes}">
                            <div class="cotacao-header">
                                <h4 th:text="${cotacao.fornecedor}">Fornecedor ABC</h4>
                                <span class="cotacao-status" th:classappend="${cotacao.status}" th:text="${cotacao.status}">Recebida</span>
                            </div>
                            <div class="cotacao-details">
                                <div class="detail-row">
                                    <span class="label">Valor Total:</span>
                                    <span class="value" th:text="${#numbers.formatDecimal(cotacao.valorTotal, 1, 2)}">R$ 150,00</span>
                                </div>
                                <div class="detail-row">
                                    <span class="label">Prazo:</span>
                                    <span class="value" th:text="${cotacao.prazoEntrega}">15 dias</span>
                                </div>
                                <div class="detail-row">
                                    <span class="label">Data:</span>
                                    <span class="value" th:text="${#temporals.format(cotacao.dataRecebimento, 'dd/MM/yyyy')}">20/01/2024</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="pedido-section" th:if="${requisicao.pedido != null}">
                    <h3>Informações do Pedido</h3>
                    <div class="detail-card">
                        <div class="detail-row">
                            <span class="label">Número do Pedido:</span>
                            <span class="value" th:text="${requisicao.pedido.numero}">PED-001</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">Fornecedor:</span>
                            <span class="value" th:text="${requisicao.pedido.fornecedor}">Fornecedor ABC</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">Data do Pedido:</span>
                            <span class="value" th:text="${#temporals.format(requisicao.pedido.dataPedido, 'dd/MM/yyyy')}">25/01/2024</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">Valor Total:</span>
                            <span class="value" th:text="${#numbers.formatDecimal(requisicao.pedido.valorTotal, 1, 2)}">R$ 150,00</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">Status:</span>
                            <span class="status-badge" th:classappend="${requisicao.pedido.status}" th:text="${requisicao.pedido.status}">Processando</span>
                        </div>
                    </div>
                </div>

                <div class="actions-section">
                    <h3>Ações</h3>
                    <div class="action-buttons">
                        <button th:if="${requisicao.status == 'PENDENTE'}" class="btn btn-success" onclick="aprovarRequisicao()">
                            <i class="fas fa-check"></i>
                            Aprovar
                        </button>
                        <button th:if="${requisicao.status == 'PENDENTE'}" class="btn btn-danger" onclick="rejeitarRequisicao()">
                            <i class="fas fa-times"></i>
                            Rejeitar
                        </button>
                        <button th:if="${requisicao.status == 'APROVADA'}" class="btn btn-info" onclick="iniciarCotacao()">
                            <i class="fas fa-search"></i>
                            Iniciar Cotação
                        </button>
                        <button th:if="${requisicao.status == 'EM_COTACAO'}" class="btn btn-warning" onclick="realizarPedido()">
                            <i class="fas fa-shopping-cart"></i>
                            Realizar Pedido
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 Sistema de Requisição de Compra. Todos os direitos reservados.</p>
        </div>
    </footer>

    <!-- Modal de confirmação -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Confirmar Ação</h3>
                <span class="close" onclick="fecharModal()">&times;</span>
            </div>
            <div class="modal-body">
                <p id="modalMessage">Tem certeza que deseja realizar esta ação?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="fecharModal()">Cancelar</button>
                <button id="confirmButton" class="btn btn-primary">Confirmar</button>
            </div>
        </div>
    </div>

    <script src="js/main.js"></script>
    <script>
        function aprovarRequisicao() {
            mostrarModal('Aprovar Requisição', 'Tem certeza que deseja aprovar esta requisição?', function() {
                // Aqui você faria a chamada para aprovar a requisição
                window.location.href = '/requisicoes/' + /*[[${requisicao.id}]]*/ + '/aprovar';
            });
        }

        function rejeitarRequisicao() {
            mostrarModal('Rejeitar Requisição', 'Tem certeza que deseja rejeitar esta requisição?', function() {
                // Aqui você faria a chamada para rejeitar a requisição
                window.location.href = '/requisicoes/' + /*[[${requisicao.id}]]*/ + '/rejeitar';
            });
        }

        function iniciarCotacao() {
            mostrarModal('Iniciar Cotação', 'Tem certeza que deseja iniciar o processo de cotação?', function() {
                // Aqui você faria a chamada para iniciar cotação
                window.location.href = '/requisicoes/' + /*[[${requisicao.id}]]*/ + '/iniciar-cotacao';
            });
        }

        function realizarPedido() {
            mostrarModal('Realizar Pedido', 'Tem certeza que deseja realizar o pedido?', function() {
                // Aqui você faria a chamada para realizar pedido
                window.location.href = '/requisicoes/' + /*[[${requisicao.id}]]*/ + '/realizar-pedido';
            });
        }

        function mostrarModal(title, message, callback) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            document.getElementById('confirmButton').onclick = function() {
                callback();
                fecharModal();
            };
            document.getElementById('confirmModal').style.display = 'block';
        }

        function fecharModal() {
            document.getElementById('confirmModal').style.display = 'none';
        }
    </script>
</body>
</html>

